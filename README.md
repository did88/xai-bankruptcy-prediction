# 📊 Risk Radar - 부실기업 예측 기반 맞춤형 투자 추천 시스템

## 🔍 프로젝트 개요

**Risk Radar**는 금융 지식이 부족한 Thin Filer를 위한  
**부실기업 예측 기반 투자 보조 서비스**입니다.  
사용자의 투자 성향에 맞는 종목을 추천하며, 부실 위험 기업을 사전에 차단합니다.

---

## 📁 전체 워크플로우

### 1. 데이터 수집 (2015~2023)
- **출처**: DART API, OPENDART, KRX, ECOS
- **대상**: KOSPI/KOSDAQ 상장 비금융 기업

### 2. 대상 기업 선정
- **정상 기업**: 상장 유지 기업
- **부실 기업 정의**:
  - 비자발적 상장폐지

### 3. 후보 피처 수집
- **재무 지표**: 유동비율, ROA 등
- **현금흐름 지표**: 영업현금흐름/부채 등
- **비재무 지표**: 베타, 시가총액, PER 등
- **시장 지표**: 52주 수익률, 주가 변동성 등
- **거시 지표**: 금리차, 환율, GDP 성장률 등

### 4. Filter 1: 부실 기업 예측
- 학습된 모델로 부실 기업 여부(0/1) 분류
- 사용자 입력 종목 중 부실 기업 자동 제거

### 5. 탐색적 데이터 분석 (EDA)
- Histogram, Box Plot, Violin Plot
- Q-Q Plot (정규성 검정)
- 피어슨 상관 분석
- t-test (정상 vs 부실 변수 유의성 검정)

### 6. 데이터 전처리
- 분할
- 결측치 및 이상치 처리
- 클래스 불균형 처리 (Resampling)
- 정규화 (StandardScaler)

### 7. 피처 셀렉션
- **MDA (Mean Decrease Accuracy)**: Random Forest 기반 중요도
- **LASSO 회귀**: 변수 축소 및 선택

### 8. 모델링
- **모델 후보**:
  - Logistic Regression
  - LDA (MDA)
  - Random Forest
  - LightGBM
- **모델 하이퍼파라미터**
  - ...
- **성능 지표**:
  - F1 Score
  - AUC-ROC Curve

### 9. Filter 2: 투자 전략 알고리즘
- 섹터 베타 기준 분류(바꿀 예정)
  - 0.8 미만: 저변동
  - 0.8 ~ 1.2: 중간
  - 1.2 초과: 고변동
- 대표 섹터 기업:
  - 고: 반도체: 삼성전자
  - 중: 소비재: 신세계
  - 저: 공공: 한국전력

### 10. 최적 증권 선택
- 사용자 성향 매칭 기반 비율 추천
- 예시:
  - 고변동 선호 → B 기업 70%
  - 중간 변동 → C 기업 30%

### 11. 대시보드 구현
- 사용자 종목 입력 → 부실 예측 → 종목 필터링
- 투자 성향 입력 → 맞춤형 비율 추천
- 예시 출력:
  > "A 기업은 부실 예측으로 제외.  
  > B(반도체) 70%, C(소매업) 30% 추천"

---

## 📌 기대 효과

- 부실기업 투자 사전 차단
- 투자자 위험 성향 기반 추천
- 초보자의 투자 신뢰도 및 효율 향상

## 📌 향후 계획
- 섹터 분류 기준 개선 (베타 외 대안 탐색)
- 온라인 학습 기반 모델 고도화
- 대시보드 UX 개선 및 기능 추가 (알림, 백테스트 리포트 등)

---

## 사용법
```bash
python src/bankruptcy_models.py your_data.xlsx
```

### DART 재무제표 수집

다음 스크립트는 DART API를 이용해 KOSPI/KOSDAQ 비금융기업의 재무제표를 병렬로 내려받습니다.

```bash
python -m src.dart_bulk_downloader
```

#### 데이터 수집 기준

1. `https://opendart.fss.or.kr/api/corpCode.xml` 엔드포인트로 전체 기업 코드 목록을 받아옵니다.
2. 6자리 주식코드가 존재하는 기업 중 KOSPI/KOSDAQ 상장사를 선택합니다.
3. 기업명에 `은행`, `보험`, `증권` 등 금융 관련 키워드가 포함된 경우 제외하여 비금융 기업만 남깁니다.
4. 각 `corp_code`에 대해 `https://opendart.fss.or.kr/api/fnlttSinglAcnt.json`을 호출합니다.
   - `bsns_year`는 기본적으로 2015~2022년을 대상으로 합니다.
   - `reprt_code`는 사업보고서(`11011`)를 사용합니다.
   - 우선 연결재무제표(`fs_div=CFS`)를 시도하고, 데이터가 없으면 개별재무제표(`fs_div=OFS`)를 조회합니다.
5. 요청 속도는 분당 600회 이하로 제한하여 DART의 이용 제한에 저촉되지 않도록 합니다.
6. 최종 데이터에는 기업코드, 기업명, 주식코드, 연도, 재무제표 구분 등 22개 컬럼이 포함됩니다.

인터랙티브 예제는 `notebooks/` 디렉터리를 참고하세요.

추가로 `fnlttSinglAcntAll` 엔드포인트를 이용해 연도별 재무상태표와 손익계산서를
종류별로 저장하는 스크립트가 제공됩니다.

```bash
python scripts/fetch_financial_statements.py
```

기존 진행 상황을 무시하고 처음부터 다시 받고 싶다면 `--reset` 옵션을 사용할 수 있습니다.

```bash
python scripts/fetch_financial_statements.py --reset
```

실행하면 연결재무제표와 개별재무제표의 재무상태표·손익계산서가
`data/raw/` 디렉터리에 각각 CSV 파일로 저장됩니다. 진행 상황은
`tqdm` 프로그레스 바로 표시되며, 중간에 실행을 중단해도
`data/raw/financial_statements_progress.csv` 파일을 이용해 자동으로
이어받기를 시도합니다.

### KRX 52주 베타 계산

`pykrx` 라이브러리를 이용해 특정 종목의 52주 베타를 구하는 스크립트입니다.

```bash
python -m src.krx_beta  # 기본으로 삼성전자 코드(005930) 사용
```

